version: '3.8'

services:
  jupyter-pytorch:
    image: pytorch/pytorch:1.12.1-cuda11.3-cudnn8-runtime
    container_name: ai-jupyter-pytorch
    restart: unless-stopped
    ports:
      - "8888:8888"
    volumes:
      - ${HOME}/ai-workspace:/workspace
      - ${HOME}/.jupyter:/root/.jupyter
    environment:
      - JUPYTER_ENABLE_LAB=yes
      - NVIDIA_VISIBLE_DEVICES=all
    command: >
      bash -c "pip install jupyterlab ipywidgets matplotlib seaborn pandas scikit-learn &&
               jupyter lab --ip=0.0.0.0 --port=8888 --no-browser --allow-root 
               --NotebookApp.token='' --NotebookApp.password=''"
    runtime: nvidia

  jupyter-tensorflow:
    image: tensorflow/tensorflow:2.8.0-gpu-jupyter
    container_name: ai-jupyter-tensorflow
    restart: unless-stopped
    ports:
      - "8889:8888"
    volumes:
      - ${HOME}/ai-workspace:/tf/workspace
      - ${HOME}/.jupyter:/root/.jupyter
    environment:
      - JUPYTER_ENABLE_LAB=yes
      - NVIDIA_VISIBLE_DEVICES=all
    command: >
      bash -c "pip install jupyterlab matplotlib seaborn pandas scikit-learn &&
               jupyter lab --ip=0.0.0.0 --port=8888 --no-browser --allow-root 
               --NotebookApp.token='' --NotebookApp.password=''"
    runtime: nvidia

  cuda-dev:
    image: nvidia/cuda:11.4.3-devel-ubuntu20.04
    container_name: ai-cuda-dev
    restart: unless-stopped
    ports:
      - "8080:8080"
    volumes:
      - ${HOME}/ai-workspace:/workspace
    environment:
      - NVIDIA_VISIBLE_DEVICES=all
    command: sleep infinity
    runtime: nvidia

  code-server:
    image: codercom/code-server:latest
    container_name: ai-code-server
    restart: unless-stopped
    ports:
      - "8443:8080"
    volumes:
      - ${HOME}/ai-workspace:/home/coder/workspace
      - ${HOME}/.config:/home/coder/.config
    environment:
      - PASSWORD=ai-development
    command: --bind-addr 0.0.0.0:8080 /home/coder/workspace

volumes:
  ai-workspace:
    driver: local